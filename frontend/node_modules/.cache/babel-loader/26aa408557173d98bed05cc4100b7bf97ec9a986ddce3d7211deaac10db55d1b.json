{"ast":null,"code":"import { io } from 'socket.io-client';\nclass SocketService {\n  constructor() {\n    this.socket = null;\n    this.messageCallbacks = [];\n    this.userOnlineCallbacks = [];\n    this.userOfflineCallbacks = [];\n    this.typingCallbacks = [];\n    this.heartbeatInterval = null;\n    this.lastToken = '';\n  }\n  connect(token) {\n    this.lastToken = token;\n    if (!this.socket || this.socket.disconnected) {\n      this.socket = io(process.env.REACT_APP_API_URL || 'http://localhost:8000', {\n        auth: {\n          token\n        },\n        transports: ['websocket', 'polling'],\n        // Allow fallback to polling for faster connection\n        reconnection: true,\n        reconnectionDelay: 100,\n        // Reduced from 500ms to 100ms\n        reconnectionDelayMax: 1000,\n        // Reduced from 2000ms to 1000ms\n        reconnectionAttempts: 50,\n        // Increased from 20 to 50\n        forceNew: true,\n        timeout: 5000,\n        // Reduced from 10000ms to 5000ms\n        closeOnBeforeunload: false\n      });\n      this.socket.on('connect', () => {\n        console.log('Socket connected');\n        // Start heartbeat when connected\n        this.startHeartbeat();\n        // Gửi lại sự kiện đăng nhập userId để backend cập nhật lại trạng thái user\n        if (this.lastToken) {\n          var _this$socket;\n          (_this$socket = this.socket) === null || _this$socket === void 0 ? void 0 : _this$socket.emit('rejoin', {\n            token: this.lastToken\n          });\n        }\n      });\n      this.socket.on('reconnect', attemptNumber => {\n        console.log('Socket reconnected after', attemptNumber, 'attempts');\n        // Restart heartbeat on reconnect\n        this.startHeartbeat();\n      });\n      this.socket.on('reconnect_attempt', attemptNumber => {\n        console.log('Reconnection attempt:', attemptNumber);\n      });\n      this.socket.on('connect_error', error => {\n        console.error('Socket connection error:', error);\n      });\n      this.socket.on('disconnect', reason => {\n        console.log('Socket disconnected:', reason);\n        if (reason === 'transport close' || reason === 'transport error' || reason === 'ping timeout') {\n          console.log('Temporary disconnect, socket will try to reconnect...');\n          setTimeout(() => {\n            var _this$socket2;\n            if (!((_this$socket2 = this.socket) !== null && _this$socket2 !== void 0 && _this$socket2.connected)) {\n              console.log('Force reconnecting socket after disconnect...');\n              this.forceReconnect(this.lastToken);\n            }\n          }, 2000);\n        } else {\n          console.log('Permanent disconnect:', reason);\n        }\n      });\n      this.socket.on('reconnect_failed', () => {\n        console.error('Socket failed to reconnect after all attempts');\n      });\n      this.socket.on('reconnect_error', error => {\n        console.error('Socket reconnection error:', error);\n      });\n\n      // Message events\n      this.socket.on('newMessage', message => {\n        var _this$socket3, _this$socket4;\n        console.log('Received new message:', message, 'Current user:', (_this$socket3 = this.socket) === null || _this$socket3 === void 0 ? void 0 : _this$socket3.id, 'Auth:', (_this$socket4 = this.socket) === null || _this$socket4 === void 0 ? void 0 : _this$socket4.auth);\n        // Gọi callback để cập nhật UI ngay lập tức\n        this.messageCallbacks.forEach(callback => callback(message));\n      });\n      this.socket.on('messageConfirmed', message => {\n        var _this$socket5, _this$socket6;\n        console.log('Message confirmed:', message, 'Current user:', (_this$socket5 = this.socket) === null || _this$socket5 === void 0 ? void 0 : _this$socket5.id, 'Auth:', (_this$socket6 = this.socket) === null || _this$socket6 === void 0 ? void 0 : _this$socket6.auth);\n        this.messageCallbacks.forEach(callback => callback(message));\n      });\n      this.socket.on('messageError', error => {\n        console.error('Message error:', error);\n      }); // User status events\n      this.socket.on('userOnline', userId => {\n        this.userOnlineCallbacks.forEach(callback => callback(userId));\n      });\n      this.socket.on('userOffline', userId => {\n        this.userOfflineCallbacks.forEach(callback => callback(userId));\n      });\n\n      // Typing events\n      this.socket.on('userTyping', data => {\n        this.typingCallbacks.forEach(callback => callback(data));\n      });\n      this.socket.on('ping', () => {\n        var _this$socket7;\n        // Khi nhận được ping từ server, gửi lại pong để giữ kết nối\n        (_this$socket7 = this.socket) === null || _this$socket7 === void 0 ? void 0 : _this$socket7.emit('pong');\n      });\n    }\n    return this.socket;\n  }\n  disconnect() {\n    this.stopHeartbeat();\n    if (this.socket) {\n      this.socket.removeAllListeners();\n      this.socket.disconnect();\n      this.socket = null;\n    }\n  }\n  forceReconnect(token) {\n    console.log('Force reconnecting socket...');\n    this.disconnect();\n    return this.connect(token);\n  }\n  isConnected() {\n    return this.socket && this.socket.connected;\n  }\n  startHeartbeat() {\n    this.stopHeartbeat();\n    // Gửi heartbeat mỗi 10 giây để giữ kết nối luôn sống\n    this.heartbeatInterval = setInterval(() => {\n      if (this.socket && this.socket.connected) {\n        this.socket.emit('heartbeat');\n        console.log('Heartbeat sent');\n      }\n    }, 10000); // 10 giây\n  }\n  stopHeartbeat() {\n    if (this.heartbeatInterval) {\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n    }\n  }\n  sendMessage(receiverId, content, messageType = 'text') {\n    if (this.socket) {\n      this.socket.emit('sendMessage', {\n        receiverId,\n        content,\n        messageType\n      });\n    }\n  }\n  onMessage(callback) {\n    this.messageCallbacks.push(callback);\n    return () => this.removeMessageCallback(callback);\n  }\n  onUserOnline(callback) {\n    this.userOnlineCallbacks.push(callback);\n    return () => this.removeUserOnlineCallback(callback);\n  }\n  onUserOffline(callback) {\n    this.userOfflineCallbacks.push(callback);\n    return () => this.removeUserOfflineCallback(callback);\n  }\n\n  // Keep for backward compatibility\n  onUserStatus(callback) {\n    return this.onUserOnline(callback);\n  }\n  onTyping(callback) {\n    this.typingCallbacks.push(callback);\n    return () => this.removeTypingCallback(callback);\n  }\n  sendTypingStatus(receiverId, isTyping) {\n    if (this.socket) {\n      this.socket.emit('typing', {\n        receiverId,\n        isTyping\n      });\n    }\n  }\n  markAsRead(senderId) {\n    if (this.socket) {\n      this.socket.emit('markAsRead', {\n        senderId\n      });\n    }\n  }\n  off(event) {\n    if (this.socket) {\n      this.socket.off(event);\n    }\n  }\n  getSocket() {\n    return this.socket;\n  }\n  removeMessageCallback(callback) {\n    this.messageCallbacks = this.messageCallbacks.filter(cb => cb !== callback);\n  }\n  removeUserOnlineCallback(callback) {\n    this.userOnlineCallbacks = this.userOnlineCallbacks.filter(cb => cb !== callback);\n  }\n  removeUserOfflineCallback(callback) {\n    this.userOfflineCallbacks = this.userOfflineCallbacks.filter(cb => cb !== callback);\n  }\n  removeTypingCallback(callback) {\n    this.typingCallbacks = this.typingCallbacks.filter(cb => cb !== callback);\n  }\n}\nexport const socketService = new SocketService();\nexport default socketService;","map":{"version":3,"names":["io","SocketService","constructor","socket","messageCallbacks","userOnlineCallbacks","userOfflineCallbacks","typingCallbacks","heartbeatInterval","lastToken","connect","token","disconnected","process","env","REACT_APP_API_URL","auth","transports","reconnection","reconnectionDelay","reconnectionDelayMax","reconnectionAttempts","forceNew","timeout","closeOnBeforeunload","on","console","log","startHeartbeat","_this$socket","emit","attemptNumber","error","reason","setTimeout","_this$socket2","connected","forceReconnect","message","_this$socket3","_this$socket4","id","forEach","callback","_this$socket5","_this$socket6","userId","data","_this$socket7","disconnect","stopHeartbeat","removeAllListeners","isConnected","setInterval","clearInterval","sendMessage","receiverId","content","messageType","onMessage","push","removeMessageCallback","onUserOnline","removeUserOnlineCallback","onUserOffline","removeUserOfflineCallback","onUserStatus","onTyping","removeTypingCallback","sendTypingStatus","isTyping","markAsRead","senderId","off","event","getSocket","filter","cb","socketService"],"sources":["C:/Users/trann/Desktop/jwt-bt/frontend/src/services/socketService.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\r\nimport { Message, ChatUser } from './chatService';\r\n\r\ntype MessageCallback = (message: Message) => void;\r\ntype UserOnlineCallback = (userId: string) => void;\r\ntype UserOfflineCallback = (userId: string) => void;\r\ntype TypingCallback = (data: { userId: string, isTyping: boolean }) => void;\r\n\r\nclass SocketService {\r\n  private socket: Socket | null = null;\r\n  private messageCallbacks: MessageCallback[] = [];\r\n  private userOnlineCallbacks: UserOnlineCallback[] = [];\r\n  private userOfflineCallbacks: UserOfflineCallback[] = [];\r\n  private typingCallbacks: TypingCallback[] = [];\r\n  private heartbeatInterval: NodeJS.Timeout | null = null;\r\n  private lastToken: string = '';\r\n\r\n  connect(token: string) {\r\n    this.lastToken = token;\r\n    if (!this.socket || this.socket.disconnected) {\r\n      this.socket = io(process.env.REACT_APP_API_URL || 'http://localhost:8000', {\r\n        auth: { token },\r\n        transports: ['websocket', 'polling'], // Allow fallback to polling for faster connection\r\n        reconnection: true,\r\n        reconnectionDelay: 100, // Reduced from 500ms to 100ms\r\n        reconnectionDelayMax: 1000, // Reduced from 2000ms to 1000ms\r\n        reconnectionAttempts: 50, // Increased from 20 to 50\r\n        forceNew: true,\r\n        timeout: 5000, // Reduced from 10000ms to 5000ms\r\n        closeOnBeforeunload: false\r\n      });this.socket.on('connect', () => {\r\n        console.log('Socket connected');\r\n        // Start heartbeat when connected\r\n        this.startHeartbeat();\r\n        // Gửi lại sự kiện đăng nhập userId để backend cập nhật lại trạng thái user\r\n        if (this.lastToken) {\r\n          this.socket?.emit('rejoin', { token: this.lastToken });\r\n        }\r\n      });\r\n\r\n      this.socket.on('reconnect', (attemptNumber) => {\r\n        console.log('Socket reconnected after', attemptNumber, 'attempts');\r\n        // Restart heartbeat on reconnect\r\n        this.startHeartbeat();\r\n      });\r\n\r\n      this.socket.on('reconnect_attempt', (attemptNumber) => {\r\n        console.log('Reconnection attempt:', attemptNumber);\r\n      });\r\n\r\n      this.socket.on('connect_error', (error: Error) => {\r\n        console.error('Socket connection error:', error);\r\n      });      this.socket.on('disconnect', (reason) => {\r\n        console.log('Socket disconnected:', reason);\r\n        if (reason === 'transport close' || \r\n            reason === 'transport error' || \r\n            reason === 'ping timeout') {\r\n          console.log('Temporary disconnect, socket will try to reconnect...');\r\n          setTimeout(() => {\r\n            if (!this.socket?.connected) {\r\n              console.log('Force reconnecting socket after disconnect...');\r\n              this.forceReconnect(this.lastToken);\r\n            }\r\n          }, 2000);\r\n        } else {\r\n          console.log('Permanent disconnect:', reason);\r\n        }\r\n      });      this.socket.on('reconnect_failed', () => {\r\n        console.error('Socket failed to reconnect after all attempts');\r\n      });\r\n\r\n      this.socket.on('reconnect_error', (error) => {\r\n        console.error('Socket reconnection error:', error);\r\n      });\r\n\r\n      // Message events\r\n      this.socket.on('newMessage', (message: Message) => {\r\n        console.log('Received new message:', message, 'Current user:', this.socket?.id, 'Auth:', this.socket?.auth);\r\n        // Gọi callback để cập nhật UI ngay lập tức\r\n        this.messageCallbacks.forEach(callback => callback(message));\r\n      });\r\n\r\n      this.socket.on('messageConfirmed', (message: Message) => {\r\n        console.log('Message confirmed:', message, 'Current user:', this.socket?.id, 'Auth:', this.socket?.auth);\r\n        this.messageCallbacks.forEach(callback => callback(message));\r\n      });\r\n\r\n      this.socket.on('messageError', (error: { error: string }) => {\r\n        console.error('Message error:', error);\r\n      });      // User status events\r\n      this.socket.on('userOnline', (userId: string) => {\r\n        this.userOnlineCallbacks.forEach(callback => callback(userId));\r\n      });\r\n\r\n      this.socket.on('userOffline', (userId: string) => {\r\n        this.userOfflineCallbacks.forEach(callback => callback(userId));\r\n      });\r\n\r\n      // Typing events\r\n      this.socket.on('userTyping', (data: { userId: string, isTyping: boolean }) => {\r\n        this.typingCallbacks.forEach(callback => callback(data));\r\n      });\r\n\r\n      this.socket.on('ping', () => {\r\n        // Khi nhận được ping từ server, gửi lại pong để giữ kết nối\r\n        this.socket?.emit('pong');\r\n      });\r\n    }\r\n    return this.socket;\r\n  }  disconnect() {\r\n    this.stopHeartbeat();\r\n    if (this.socket) {\r\n      this.socket.removeAllListeners();\r\n      this.socket.disconnect();\r\n      this.socket = null;\r\n    }\r\n  }\r\n\r\n  forceReconnect(token: string) {\r\n    console.log('Force reconnecting socket...');\r\n    this.disconnect();\r\n    return this.connect(token);\r\n  }\r\n\r\n  isConnected() {\r\n    return this.socket && this.socket.connected;\r\n  }\r\n  private startHeartbeat() {\r\n    this.stopHeartbeat();\r\n    // Gửi heartbeat mỗi 10 giây để giữ kết nối luôn sống\r\n    this.heartbeatInterval = setInterval(() => {\r\n      if (this.socket && this.socket.connected) {\r\n        this.socket.emit('heartbeat');\r\n        console.log('Heartbeat sent');\r\n      }\r\n    }, 10000); // 10 giây\r\n  }\r\n\r\n  private stopHeartbeat() {\r\n    if (this.heartbeatInterval) {\r\n      clearInterval(this.heartbeatInterval);\r\n      this.heartbeatInterval = null;\r\n    }\r\n  }\r\n\r\n  sendMessage(receiverId: string, content: string, messageType: string = 'text') {\r\n    if (this.socket) {\r\n      this.socket.emit('sendMessage', { receiverId, content, messageType });\r\n    }\r\n  }\r\n  onMessage(callback: MessageCallback) {\r\n    this.messageCallbacks.push(callback);\r\n    return () => this.removeMessageCallback(callback);\r\n  }\r\n\r\n  onUserOnline(callback: UserOnlineCallback) {\r\n    this.userOnlineCallbacks.push(callback);\r\n    return () => this.removeUserOnlineCallback(callback);\r\n  }\r\n\r\n  onUserOffline(callback: UserOfflineCallback) {\r\n    this.userOfflineCallbacks.push(callback);\r\n    return () => this.removeUserOfflineCallback(callback);\r\n  }\r\n\r\n  // Keep for backward compatibility\r\n  onUserStatus(callback: UserOnlineCallback) {\r\n    return this.onUserOnline(callback);\r\n  }\r\n\r\n  onTyping(callback: TypingCallback) {\r\n    this.typingCallbacks.push(callback);\r\n    return () => this.removeTypingCallback(callback);\r\n  }\r\n\r\n  sendTypingStatus(receiverId: string, isTyping: boolean) {\r\n    if (this.socket) {\r\n      this.socket.emit('typing', { receiverId, isTyping });\r\n    }\r\n  }\r\n\r\n  markAsRead(senderId: string) {\r\n    if (this.socket) {\r\n      this.socket.emit('markAsRead', { senderId });\r\n    }\r\n  }\r\n\r\n  off(event: string) {\r\n    if (this.socket) {\r\n      this.socket.off(event);\r\n    }\r\n  }\r\n\r\n  getSocket() {\r\n    return this.socket;\r\n  }\r\n  private removeMessageCallback(callback: MessageCallback) {\r\n    this.messageCallbacks = this.messageCallbacks.filter(cb => cb !== callback);\r\n  }\r\n\r\n  private removeUserOnlineCallback(callback: UserOnlineCallback) {\r\n    this.userOnlineCallbacks = this.userOnlineCallbacks.filter(cb => cb !== callback);\r\n  }\r\n\r\n  private removeUserOfflineCallback(callback: UserOfflineCallback) {\r\n    this.userOfflineCallbacks = this.userOfflineCallbacks.filter(cb => cb !== callback);\r\n  }\r\n\r\n  private removeTypingCallback(callback: TypingCallback) {\r\n    this.typingCallbacks = this.typingCallbacks.filter(cb => cb !== callback);\r\n  }\r\n}\r\n\r\nexport const socketService = new SocketService();\r\nexport default socketService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}